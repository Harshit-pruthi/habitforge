<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HabitForge â€” Sign in</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f4f7fb; --card:#ffffff; --accent1:#2b6ef6; --accent2:#6a9cff; --text:#07122a; --muted:#6b7280;
  }
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto;background:var(--bg);color:var(--text);display:flex;align-items:center;justify-content:center;height:100vh;padding:16px}
  .box{width:100%;max-width:420px;background:var(--card);border-radius:14px;padding:20px;box-shadow:0 18px 50px rgba(12,18,36,0.08);text-align:center}
  .logo{width:64px;height:64px;margin:0 auto;border-radius:12px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:grid;place-items:center;color:white;font-weight:800;font-size:20px}
  h1{margin:14px 0 6px 0;font-size:20px}
  p.lead{margin:0;color:var(--muted);font-size:14px}
  .btn{display:inline-flex;align-items:center;gap:10px;padding:12px 16px;margin-top:18px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
  .btn.google{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;box-shadow:0 10px 28px rgba(43,110,246,0.16)}
  .btn.guest{background:transparent;border:1px solid rgba(10,20,40,0.06);color:var(--text)}
  .small{font-size:13px;color:var(--muted);margin-top:10px}
  .spinner{width:18px;height:18px;border-radius:50%;border:3px solid rgba(255,255,255,0.28);border-top-color:rgba(255,255,255,0.95);animation:spin .9s linear infinite;display:inline-block}
  @keyframes spin{to{transform:rotate(360deg)}}
  footer{margin-top:14px;color:var(--muted);font-size:12px}
  a.inline{color:var(--accent1);text-decoration:none;font-weight:700}
</style>
</head>
<body>
  <main class="box" role="main" aria-label="HabitForge sign in">
    <div class="logo">HF</div>
    <h1>Welcome to HabitForge</h1>
    <p class="lead">Track habits, build plans and stay consistent. Sign in to sync across devices.</p>

    <div id="authArea">
      <button id="btnGoogle" class="btn google" aria-label="Sign in with Google"> 
        <span id="googleIcon">ðŸ”’</span>
        <span id="googleText">Sign in with Google</span>
      </button>

      <div style="margin-top:10px">
        <button id="btnGuest" class="btn guest">Continue as guest</button>
      </div>

      <div class="small" id="statusMsg">Your data will be saved locally until you sign in.</div>
    </div>

    <footer>
      <div>By signing in you agree to use this app responsibly.</div>
      <div style="margin-top:6px"><a class="inline" href="dashboard.html">Open dashboard directly</a></div>
    </footer>
  </main>

  <!-- Firebase + sign-in logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-analytics.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

    // <-- your Firebase config (provided earlier) -->
    const firebaseConfig = {
      apiKey: "AIzaSyAPrqqUbYzcPgFa34tKZvEB9IkT5yReJmw",
      authDomain: "habitforge-185f6.firebaseapp.com",
      projectId: "habitforge-185f6",
      storageBucket: "habitforge-185f6.firebasestorage.app",
      messagingSenderId: "23479259079",
      appId: "1:23479259079:web:3681e77d6684adf636d3e2",
      measurementId: "G-LP0P86N6LN"
    };

    const app = initializeApp(firebaseConfig);
    try { getAnalytics(app); } catch(e){ /* analytics may fail in some environments */ }
    const auth = getAuth();
    const provider = new GoogleAuthProvider();

    const btnGoogle = document.getElementById('btnGoogle');
    const btnGuest = document.getElementById('btnGuest');
    const statusMsg = document.getElementById('statusMsg');
    const googleText = document.getElementById('googleText');
    const googleIcon = document.getElementById('googleIcon');

    // If already signed in -> redirect to dashboard immediately
    onAuthStateChanged(auth, user => {
      if(user){
        statusMsg.textContent = `Signed in as ${user.displayName || user.email}. Redirecting to dashboard...`;
        setTimeout(()=> location.href = 'dashboard.html', 600);
      } else {
        statusMsg.textContent = 'Your data will be saved locally until you sign in.';
      }
    });

    // Sign in flow (popup)
    btnGoogle.addEventListener('click', async () => {
      try {
        googleIcon.innerHTML = ''; googleText.textContent = 'Signing in...';
        googleText.prepend('');
        await signInWithPopup(auth, provider);
        // onAuthStateChanged will redirect
      } catch(err) {
        console.error(err);
        googleText.textContent = 'Sign in with Google';
        alert('Sign-in failed: ' + (err.message || err));
      }
    });

    // Continue as guest -> dashboard (no auth)
    btnGuest.addEventListener('click', () => {
      location.href = 'dashboard.html';
    });
  </script>
</body>
</html>
